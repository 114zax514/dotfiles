#!/bin/bash

function opwd()
{
    local current_pane_number="$(tmux list-panes | grep 'active' | cut -d: -f1)"
    local current_window_number="$(tmux display -p '#I')"

    if [[ ! -f ~/.tmux.info ]]; then
        return 1
    fi

    cat < ~/.tmux.info |
    if (($# > 0)) &&
        expr "$1" : '^[0-9]$' >/dev/null &&
        tmux list-panes | grep -q "^$1"
    then
        grep "$current_window_number:$1"
    else
        grep -v "$current_window_number:$current_pane_number"
    fi | tail -1 |
    if [[ "$1" == "-n" ]]; then
        cut -d: -f2
    else
        cut -d: -f3
    fi
}

if [[ -n $TMUX ]]; then
    opwd "$@"
else
    pwd
fi
