#!/bin/bash
# git-grab grabs the repository from GitHub

. "$DOTPATH"/etc/lib/vital.sh

if ! is_git_repo; then
    echo "Not a git repository (or any of the parent directories)" 1>&2
    exit 1
fi

# Check if $1 consists of user name and repository name with a slash
# e.g., 'b4b4r07/dotfiles'
if [[ ! $1 =~ [A-Za-z0-9_-]+/[A-Za-z0-9_-]+ ]]; then
    echo "usage: git-grab username/reponame [<dest>]" 1>&2
    exit 1
fi

# dest
if [ -z "$2" ]; then
    target=~/src/github.com/"$1"
else
    target="$2/${1##*/}"
fi
if [ -d "$target" ]; then
    echo "$target: already exists" 1>&2
    exit 1
fi

target="${target%/*}"
mkdir -p "$target" 2>/dev/null
builtin cd "$target" 2>/dev/null
if [ $? -ne 0 ]; then
    echo "$1: cannot grap: install it, manually" 1>&2
    exit 1
fi

git clone https://github.com/"$1".git "${1##*/}"
